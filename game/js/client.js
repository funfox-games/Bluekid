import{auth,onAuthStateChanged,onValue,realtime,realtimeGet,realtimeUpdate,ref}from"../../js/util/firebase.js";import{BluekidClient,listenForEvent,sendEventToOwner}from"./clientUtil.js";var gameId;function gameExists(i){return new Promise(async(e,a)=>{var t=ref(realtime,"games/"+i);e((await realtimeGet(t)).exists())})}onAuthStateChanged(auth,async e=>{var i=JSON.parse(sessionStorage.getItem("joinningGame"));if(gameId=i.gameId,BluekidClient.setGameId(gameId),await gameExists(gameId)){let e=ref(realtime,"games/"+gameId),a=!1,t=await BluekidClient.addPlayer(i.username);setTimeout(()=>{onValue(e,e=>{console.log(e.exists()),0==e.exists()?(a=!0,location.href="../join.html?error=game_deleted"):e.val().players&&(e=e.val().players,console.log(e,t-1,e[t]),null!=e[t-1])||(location.href="../join.html?error=kicked")})},500),window.addEventListener("beforeunload",async e=>{a||sendEventToOwner("bluekid__playerleave",{id:t})})}else location.href="../join.html?error=game_not_exist"});