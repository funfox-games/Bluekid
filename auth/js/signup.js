import{initializeApp}from"https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";let firebaseConfig={apiKey:"AIzaSyDB3PJ-cXM9thcOYhajlz15b8LiirZ44Kk",authDomain:"bluekid-303db.firebaseapp.com",databaseURL:"https://bluekid-303db-default-rtdb.firebaseio.com",projectId:"bluekid-303db",storageBucket:"bluekid-303db.appspot.com",messagingSenderId:"207140973406",appId:"1:207140973406:web:888dcf699a0e7d1e30fdcf"},app=initializeApp(firebaseConfig);import{getAuth,onAuthStateChanged,GoogleAuthProvider,signInWithPopup,createUserWithEmailAndPassword}from"https://www.gstatic.com/firebasejs/10.10.0/firebase-auth.js";let auth=getAuth();import{getFirestore,doc,getDoc,setDoc}from"https://www.gstatic.com/firebasejs/10.10.0/firebase-firestore.js";let db=getFirestore(app);import{returnDefaultCreateData}from"./createdata.js";async function createUserData(i){return new Promise(async(e,t)=>{var o,a=doc(db,"users",i);1==(await getDoc(a)).exists()?t("User already exists."):(o=returnDefaultCreateData(),await setDoc(a,o).catch(e=>{console.error(e),t(e)}),e())})}document.getElementById("login").addEventListener("submit",async e=>{e.preventDefault();var e=document.getElementById("email").value,t=document.getElementById("password").value;t!=document.getElementById("confirmpassword").value?showNotification(3,"Passwords don't match."):(document.getElementById("loginbutton").setAttribute("disabled",""),document.getElementById("loginbutton").innerHTML="Logging in...",null!=(e=await createUserWithEmailAndPassword(auth,e,t).catch(e=>{var t=e.code;return console.error("("+t+") SIGNUP ERROR: "+e.message),"auth/email-already-in-use"==t?showNotification(3,"Email in use. Go to the <a href='login.html'>login</a> page to reset password."):"auth/weak-password"==t?showNotification(3,"Weak password. Try a longer one."):showNotification(3,"Something went wrong. Check the console for more details."),document.getElementById("loginbutton").removeAttribute("disabled"),document.getElementById("loginbutton").innerHTML='<i class="fa-light fa-door-open"></i> Sign up',null}))&&(console.log(e.user.uid),document.getElementById("loginbutton").innerHTML="Creating data...",await createUserData(e.user.uid).catch(e=>{showNotification(3,"Error: "+e),document.getElementById("loginbutton").removeAttribute("disabled"),document.getElementById("loginbutton").innerHTML='<i class="fa-light fa-door-open"></i> Sign up'}),showNotification(4,'Logged in successfully! <a href="../profile/index.html"><button class="puffy_button primary"><i class="fa-light fa-user"></i> Profile</button></a>')))}),document.getElementById("google").addEventListener("click",async()=>{var e=new GoogleAuthProvider,e=(auth.useDeviceLanguage(),await signInWithPopup(auth,e).catch(e=>{var t=e.code,o=e.message;GoogleAuthProvider.credentialFromError(e);return"auth/popup-closed-by-user"==t?showNotification(3,"Prompt canceled."):showNotification(3,"Something went wrong."),console.log(t,o),null}));null!=e&&(GoogleAuthProvider.credentialFromResult(e).accessToken,console.log(e.user.uid),document.getElementById("loginbutton").innerHTML="Creating data...",await createUserData(e.user.uid).catch(e=>{showNotification(3,"Error: "+e)}))}),onAuthStateChanged(auth,e=>{e&&(document.getElementById("loginbutton").setAttribute("disabled",""),document.getElementById("loginbutton").innerHTML="Logged in",document.getElementById("google").innerHTML='<img src="../asset/google.webp" alt="googleLogo" width="22"> Merge with Google',document.getElementById("loggedin").setAttribute("show",""))});