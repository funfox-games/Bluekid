<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="./assets/Bluekid.png">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito&display=swap');

        * {
            font-family: 'Nunito', sans-serif;
        }

        div#sidenav {
            width: 12.5%;
            border-radius: 5px;
            position: fixed;
            height: 98%;
            overflow: auto;
            text-align: center;
            background-color: #98deff;
            outline: 2px solid black;
        }

        #bottomnav {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;

            display: flex;
            align-items: center;
        }
        
        #updates {
            text-decoration: none;
        }

        div ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        ul li {
            padding-bottom: 10px;
        }
        li a { /* List element */
            display: block;
            color: #000;
            padding: 4px 8px;
            text-decoration: none;
            font-size: 3vh;
            display: inline-flex;
        }

        #imgtitle {
            display: none;
        }

        @media screen and (max-width: 1000px) {
            #imgtitle {
                padding-top: 10px;
                display: inline;
            }

            #title {
                display: none;
            }
        }

        li a img {
            padding-right: 10px;
        }

        #title {
            text-decoration: none; font-family: 'Titan One', cursive; margin: 0%; margin-top:5px; font-size:4vh; color: turquoise; -webkit-text-stroke-color: black; -webkit-text-stroke-width: 2px;
        }

        /* CONTEXT MENU */
        .context-menu {
            position: absolute;
            text-align: center;
            background: lightgray;
            border: 1px solid black;

            transition-duration: 500ms;
        }
      
        .context-menu ul {
            padding: 0px;
            margin: 0px;
            min-width: 150px;
            list-style: none;
        }
      
        .context-menu ul li {
            padding-bottom: 7px;
            padding-top: 7px;
            border: 1px solid black;

            transition-duration: 250ms;
        }
      
        .context-menu ul li a {
            text-decoration: none;
            color: black;
        }
      
        .context-menu ul li:hover {
            background: darkgray;
        }
        /****************************/

        .message {
            padding: 10px;
            border: 5px solid black;
            border-radius: 10px;
            background-color: rgb(85, 85, 85);
            -webkit-text-fill-color: white;
        }

        .message > * {
            padding: 0;
            margin: 0;
        }

        #messages {
            display: flex;
            margin-bottom: 10px;
            gap: 5px;
            flex-wrap: wrap;
        }

        @media screen and (max-width: 800px) {
            li a {
                font-size: 0;
            }

            li a img {
                padding-right: 0px;
            }
        }

        .profile_name_div {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #badges {
            display: flex;
            gap: 5px;
        }

        .badge {
            display: flex;
            align-items: center;
            gap: 5px;

            background-color: black;
            padding: 5px;
            border-radius: 10px;

            color: white;
        }
    </style>
</head>
<body>
    <!-- Side nav -->
    <div id="sidenav">
        <ul>
            <a href="./index.html"><img id="imgtitle" src="./assets/Bluekid.png" width="50"></a>
            <a id="title" href="./index.html">Bluekid</a>
            <hr>
            <!-- UL means unordered list -->
            <!-- LI means list item -->
    
            <li> <a style="opacity: 0.5; cursor: default;" href="#"> <img src="./assets/user-solid.svg" draggable="false" width="30"> Profile </a> </li>
            <li> <a href="./profile/blues.html"> <img src="./assets/briefcase-solid.svg" draggable="false" width="30"> Blues</a> </li>
            <li> <a href="./profile/buy.html"> <img src="./assets/cart.svg" draggable="false" width="30"> Buy</a> </li>
            <li> <a href="./profile/kits.html"> <img src="./assets/set.svg" draggable="false" width="30"> Kits</a> </li>
            <li> <a href="./profile/settings.html"> <img src="./assets/settings.svg" draggable="false" width="30"> Settings</a> </li>
            <!-- <li> <a href="#updates"> <img src="./assets/update.svg" draggable="false" width="30"> Updates</a> </li> -->
            
            <!-- <li><a>Favorites</a></li> -->
        </ul>
        <!-- <ul id="bottomnav">
            <li><a title="See updates" id="updates" href="#updates"> <img src="./assets/update.svg" draggable="false" width="30"></a></li>
            <li><a id="Logout" href="#logout"> <img src="./assets/logout.svg" draggable="false" width="30"></a></li>
        </ul> -->
    </div>

    <div id="notverify" style="display:none;margin-left: 12.5%; padding: 10px; background-color: red; font-weight: 700; border: 2px solid black; border-radius: 20px; text-align:center; margin-bottom: 1vh;">YOUR ACCOUNT IS NOT VERIFIED! <a style="color:black; text-decoration: underline;" href="./verify.html">VERIFY NOW!</a></div>

    <div id="all" style="margin-left:12.5%;padding:1px 16px;">
        <div class="profile_name_div">
            <h1 id="name">Loading profile...</h1>
            <div id="badges"></div>
        </div>
        <p id="creation-date">Please be paitent. If this takes more then 5 minutes, try to refresh. If refreshing does not work, check your wifi.<br>If everything else is checked, report the issue to me. Find my contact in the "About us" page.</p>
        <div id="profile" style="display: none;">
            <!-- <button onclick="creategame()">Create test game</button> -->

            <hr>
        </div>
        <button onclick="logout()">Log out</button>
        <div id="contextMenu" class="context-menu" style="display: none">
            <ul>
                <li><a href="#newname">Change name</a></li>
            </ul>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SETUP FIREBASE -->
    <script>
      // NOTE - INCLUDE YOUR FIREBASE CONFIG HERE FOR ANYTHING TO WORK:
      const firebaseConfig = {
        apiKey: "AIzaSyDB3PJ-cXM9thcOYhajlz15b8LiirZ44Kk",
        authDomain: "bluekid-303db.firebaseapp.com",
        databaseURL: "https://bluekid-303db-default-rtdb.firebaseio.com",
        projectId: "bluekid-303db",
        storageBucket: "bluekid-303db.appspot.com",
        messagingSenderId: "207140973406",
        appId: "1:207140973406:web:888dcf699a0e7d1e30fdcf"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <!-- SCRIPT -->
    <script type="module">
        import data from "./banned.json" assert {"type": "json"};
        let loggedinuser;
        let username;

        function logout() {
            firebase.auth().signOut();
            console.log("logged out:logoutfunction");
            alert("You have been logged out.");
            window.location.href = "./auth_pages/login.html";
        }

        const email = localStorage.getItem("email");
        const password = localStorage.getItem("pass");

        if (email || password) {
            localStorage.removeItem("email");
            localStorage.removeItem("pass");
        }

        firebase.auth().onAuthStateChanged((user) => {
            // signed in
            console.log("signed in password: " + user.uid)
            loggedinuser = user;

            if (user.email.includes("libertyunion")) {
                localStorage.setItem("isStudentEmail", true);
                console.log("is student")
            }

            if (user.emailVerified || localStorage.getItem("isStudentEmail") == "true") {
                document.getElementById("notverify").remove();
            } else {
                document.getElementById("notverify").style.display = "inline";
            }

            const playerData = firebase.firestore().collection("users").doc(user.uid);
            playerData.get().then((doc) => {
                username = doc.data().username;

                document.getElementById("name").innerHTML = "Hello, " + doc.data().username + "!";

                var time = (Date.parse(doc.data().creation) - new Date()); // milliseconds between now & user creation
                var diffDays = -Math.floor(time / 86400000); // days

                document.getElementById("creation-date").innerHTML = "Been a user for " + diffDays + " days. (Created on " + doc.data().creation + ")";
                document.title = doc.data().username + " - Bluekid";

                document.getElementById("profile").style.display = "";

                //<div class="badge" title="Given by FunFoxRR (Owner of Bluekid)">
                //   <img src="./assets/badges/OfficialCreator.png" width="32">
                //   <strong>Official Creator</strong>
                //</div>

                for (var i = 0; i < doc.data().badges.length; i++) {
                    const badge_name = doc.data().badges[i];

                    let badgeImageSrc = "./assets/Bluekid.png";
                    if (badge_name == "Official Creator") {
                        badgeImageSrc = "./assets/badges/OfficialCreator.png";
                    } else if (badge_name == "OG") {
                        badgeImageSrc = "./assets/badges/OGBadge.png";
                    } else if (badge_name == "Verified") {
                        badgeImageSrc = "./assets/badges/Verified.png";
                    }

                    const newDiv = document.createElement("div")
                    newDiv.className = "badge";
                    newDiv.title = "Given by FunFoxRR (Owner of Bluekid)";
                    newDiv.innerHTML = `<img src="${badgeImageSrc}" width="32"><strong>${badge_name}</strong>`;

                    document.getElementById("badges").appendChild(newDiv);
                }

                var bannedEmails = data.bannedEmailaddresses
                for (var i = 0; i < data.bannedEmailaddresses.length; i++) {
                    if (bannedEmails[i].email == firebase.auth().currentUser.email) {
                        document.getElementById("name").innerHTML = "You have been banned.";
                        document.getElementById("creation-date").innerHTML = "Reason: " + bannedEmails[i].reason;

                        document.getElementById("profile").remove();
                    }
                }
            })
        });

        function creategame() {
            window.location.href = "./game.html?id="+Math.floor(Math.random()*100000)+"&name="+username;
        }
    </script>

    <!-- CONTEXT MENU -->
    <script>
        document.onclick = hideMenu;
        document.oncontextmenu = rightClick;

        let isMouseOverText = false;
        let text = document.getElementById("name");
        
        function hideMenu() {
            document.getElementById("contextMenu").style.display = "none"
        }

        text.addEventListener("mouseleave", function(event) {
            isMouseOverText = false;
        })

        text.addEventListener("mouseover", function(event) {
            isMouseOverText = true;
        })
    
        function rightClick(e) {
            if (isMouseOverText) {
                e.preventDefault();
    
                if (document.getElementById("contextMenu").style.display == "block")
                    hideMenu();
                else {
                    var menu = document.getElementById("contextMenu")
        
                    menu.style.display = 'block';
                    menu.style.left = e.pageX + "px";
                    menu.style.top = e.pageY + "px";
                }
            }
        }
    </script>
</body>
</html>