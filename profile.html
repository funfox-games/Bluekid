<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="./assets/Bluekid.png">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito&display=swap');

        * {
            font-family: 'Nunito', sans-serif;
        }

        div#sidenav {
            width: 12.5%;
            border-radius: 5px;
            position: fixed;
            height: 98%;
            overflow: auto;
            text-align: center;
            background-color: #98deff;
            outline: 2px solid black;
        }

        #bottomnav {
            position: absolute;
            bottom: 10px;
            left: 0;
            width: 100%;

            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #updates {
            text-decoration: none;
        }

        div ul {
            margin: 0;
            padding: 0;
            list-style-type: none;
        }

        ul li {
            padding-bottom: 10px;
        }
        li a { /* List element */
            display: block;
            color: #000;
            padding: 4px 8px;
            text-decoration: none;
            font-size: 3vh;
            display: inline-flex;
        }

        #imgtitle {
            display: none;
        }

        @media screen and (max-width: 1000px) {
            #imgtitle {
                padding-top: 10px;
                display: inline;
            }

            #title {
                display: none;
            }
        }

        li a img {
            padding-right: 10px;
        }

        #title {
            text-decoration: none; font-family: 'Titan One', cursive; margin: 0%; margin-top:5px; font-size:4vh; color: turquoise; -webkit-text-stroke-color: black; -webkit-text-stroke-width: 2px;
        }

        /* CONTEXT MENU */
        .context-menu {
            position: absolute;
            text-align: center;
            background: lightgray;
            border: 1px solid black;

            transition-duration: 500ms;
        }
      
        .context-menu ul {
            padding: 0px;
            margin: 0px;
            min-width: 150px;
            list-style: none;
        }
      
        .context-menu ul li {
            padding-bottom: 7px;
            padding-top: 7px;
            border: 1px solid black;

            transition-duration: 250ms;
        }
      
        .context-menu ul li a {
            text-decoration: none;
            color: black;
        }
      
        .context-menu ul li:hover {
            background: darkgray;
        }
        /****************************/

        .message {
            padding: 10px;
            border: 5px solid black;
            border-radius: 10px;
            background-color: rgb(85, 85, 85);
            -webkit-text-fill-color: white;
        }

        .message > * {
            padding: 0;
            margin: 0;
        }

        #messages {
            display: flex;
            margin-bottom: 10px;
            gap: 5px;
            flex-wrap: wrap;
        }

        @media screen and (max-width: 800px) {
            li a {
                font-size: 0;
            }

            li a img {
                padding-right: 0px;
            }
        }

        .profile_name_div {
            display: flex;
            align-items: center;
            gap: 10px;

            background-color: #98deff;
            border-radius: 10px;
            padding: 10px;
        }

        .profile_name_div h1 {
            margin: 0;
        }

        #badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;

            margin-left:auto;
        }

        .badge {
            display: flex;
            align-items: center;
            gap: 5px;

            background-color: black;
            padding: 5px;
            border-radius: 10px;

            color: white;
        }

        .corner {
            position: fixed;
            right: 0px; bottom: 0px;
            opacity: .75;
        }

        .verifiedAcc {
            display: flex;
            flex-direction: column;
        }

        .verifiedAcc .accname {
            font-weight: bold;
        }

        .verifiedAcc p {
            margin: 0;
        }

        body {
            background-image: url("../assets/backgroundpattern.png");
            background-size: .75%;
        }

        #infos {
            display: flex;
            justify-content: center;
            flex-direction: row;
            gap: 10px;
        }
        .info_card {
            background-color: rgb(231, 231, 231);
            border-radius: 10px;
            padding: 5px;
            text-align: center;
            border: 2px solid black;

            width: 200px;
            height: 200px;
        }
        .info_card p, .info_card h2 {
            margin: 0;
        }

        @media only screen and (max-width: 760px) {
            #infos {
                flex-direction: column;
            }
             .info_card {
                width: 100%;
                height: fit-content;
            }
        }

        #door {
            position: absolute;
            bottom: 0;
            left:0;
        }
        /* TOPNAV START */
        #topnav {
            display:flex;
            text-align: center;
            gap: 5px;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 2px solid black;
            justify-content: center;

            
        }
        .topnav_item {
            display: flex;
            flex-direction: row;
            text-align: center;
            align-items: center;
            border-radius: 10px;
            gap:5px;
            padding: 5px;
            background-color: rgb(231, 231, 231);
            border: 2px solid black;
        }
        .topnav_item[data-navactive] {
            background-color: rgb(180, 180, 180);
        }
        .topnav_item a {
            color:black !important;
        }
        /*************************/

        #notice {
            display:none;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        #notice[open] {
            display:flex;
        }
        #notice button {
            font-size: 32px;
            border-radius: 10px;
            cursor:pointer;

            transition-duration: 250ms;
        }
        #notice button:hover {
            scale: 1.05;
        }
        #notice img {
            border-radius: 10px;
            border: 2px solid black;
        }

        #notice::backdrop {
            background-color: rgba(0, 0, 0, 0.541);
        }
    </style>
</head>
<body>
    <dialog id="notice">
        <h1 style="margin:0;">Big changes are coming soon!</h1>
        <p>Expect some big updates coming! Such as Game Hosting, More blues, More minigames, etc! (hehe... soon...)</p>
        <img src="assets/woah.png" alt="bluekid sneak peak">
        <br>
        <button id="closenotice">Ok</button>
    </dialog>

    <div id="topnav">
        <a href="index.html"><img src="./assets/Bluekid.png" width="44"></a>
        <div class="topnav_item" id="profile_topnav" data-navactive>
            <img src="./assets/user-solid.svg" width="32">
            <a href="./profile.html">PROFILE</a>
        </div>
        <div class="topnav_item" id="blues_topnav">
            <img src="./assets/char/blue_notexture.png" width="32">
            <a href="./profile/blues.html">BLUES</a>
        </div>
        <div class="topnav_item" id="buy_topnav">
            <img src="./assets/cart.svg" width="32">
            <a href="./profile/buy.html">BUY</a>
        </div>
        <div class="topnav_item" id="kits_topnav">
            <img src="./assets/set.svg" width="32">
            <a href="./profile/kits.html">KITS</a>
        </div>
        <div class="topnav_item" id="settings_topnav">
            <img src="./assets/settings.svg" width="32">
            <a href="./profile/settings.html">SETTINGS</a>
        </div>
    </div>

    <div id="notverify" style="display:none;margin-left: 12.5%; padding: 10px; background-color: red; font-weight: 700; border: 2px solid black; border-radius: 20px; text-align:center; margin-bottom: 1vh;">YOUR ACCOUNT IS NOT VERIFIED! <a style="color:black; text-decoration: underline;" href="./verify.html">VERIFY NOW!</a></div>

    <div id="all" style="padding:1px 16px;">
        <img style="cursor:help;" src="./assets/door.png" id="door" draggable="false" width="128">
        <div class="profile_name_div">
            <h1 id="name">Loading profile...</h1>
            <a href="./profile/settings.html#newname"><img width="32"  src="./assets/editpen.svg"></a>
            <div id="badges"></div>
        </div>
        <hr style="width: 99%;">
        <!-- <p id="creation-date">Please be paitent. If this takes more then 5 minutes, try to refresh. If refreshing does not work, check your wifi.<br>If everything else is checked, report the issue to me. Find my contact in the "About us" page.</p> -->
        <div id="profile" style="display: none;">
            <!-- <button onclick="creategame()">Create test game</button> -->
            <div id="infos">
                <div class="info_card" id="accountcreation_info">
                    <h2>Account Creation</h2>
                    <p id="creation-date">?</p>
                </div>
                <div class="info_card" id="rank_info">
                    <h2>Current Rank</h2>
                    <p id="rank">?</p>
                </div>
                <div class="info_card" id="coins_info">
                    <h2>Current Tokens</h2>
                    <p id="totalcoins">?</p>
                </div>
                <div class="info_card" id="email_info">
                    <h2>Active Email</h2>
                    <p id="email">?</p>
                </div>
            </div>
            <hr>
        </div>
        <button id="logout">Log out</button>
        <button onclick="location.href = '../docs/news.html'">News</button>
        <div id="contextMenu" class="context-menu" style="display: none">
            <ul>
                <li><a href="./profile/settings.html#newname">Change name</a></li>
            </ul>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <!-- SETUP FIREBASE -->
    <script>
      // NOTE - INCLUDE YOUR FIREBASE CONFIG HERE FOR ANYTHING TO WORK:
      const firebaseConfig = {
        apiKey: "AIzaSyDB3PJ-cXM9thcOYhajlz15b8LiirZ44Kk",
        authDomain: "bluekid-303db.firebaseapp.com",
        databaseURL: "https://bluekid-303db-default-rtdb.firebaseio.com",
        projectId: "bluekid-303db",
        storageBucket: "bluekid-303db.appspot.com",
        messagingSenderId: "207140973406",
        appId: "1:207140973406:web:888dcf699a0e7d1e30fdcf"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <!-- SCRIPT -->
    <script type="module">
        import data from "./banned.json" assert {"type": "json"};
        let loggedinuser;
        let username;

        function logout() {
            firebase.auth().signOut();
            console.log("logged out:logoutfunction");
            alert("You have been logged out.");
            window.location.href = "./auth_pages/login.html";
        }

        document.getElementById("door").onclick = function() {
            if (localStorage.getItem("minigamesIntro") == "true") {
                location.href = "./minigames/selecter.html"
            } else {
                location.href = "./minigames/intro.html"
            }
        }

        const email = localStorage.getItem("email");
        const password = localStorage.getItem("pass");

        if (email || password) {
            localStorage.removeItem("email");
            localStorage.removeItem("pass");
        }

        firebase.auth().onAuthStateChanged((user) => {
            if (!user) {
                alert("You are not logged in!");
                localStorage.setItem("isLoggedIn", false);
                location.href = "./auth_pages/login.html";
            }
            // signed in
            console.log("signed in password: " + user.uid)
            loggedinuser = user;

            document.getElementById("notice").showModal();
            document.getElementById("closenotice").addEventListener("click", () => {
                document.getElementById("notice").close();
            })

            if (user.email.includes("libertyunion")) {
                localStorage.setItem("isStudentEmail", true);
                console.log("is student")
            }

            if (user.emailVerified || localStorage.getItem("isStudentEmail") == "true") {
                document.getElementById("notverify").remove();
            } else {
                document.getElementById("notverify").style.display = "inline";
            }

            const playerData = firebase.firestore().collection("users").doc(user.uid);
            playerData.get().then((doc) => {
                username = doc.data().username;

                document.getElementById("name").innerHTML = "Hello, " + doc.data().username + "!";
                document.getElementById("rank").innerHTML = doc.data().rank;
                if (doc.data().rank == "Interm") {
                    document.getElementById("rank").innerHTML = "Intermediate";
                }
                document.getElementById("totalcoins").innerHTML = doc.data().tokens.toLocaleString() + " Tokens";
                if (user.email.includes("@gmail")) {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@gmail.com";
                } else if (user.email.includes("@outlook")) {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@outlook.com";
                } else if (user.email.includes("@libertyunion")) {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@libertyunion.org";
                } else if (user.email.includes("@swl.k12.oh.us")) {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@swl.k12.oh.us";
                } else if (user.email.includes("@yahoo")) {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@yahoo.com";
                } else {
                    document.getElementById("email").innerHTML = user.email.charAt(0) + user.email.charAt(1) + ". . . . . . .@?.?";
                }

                var time = (Date.parse(doc.data().creation) - new Date()); // milliseconds between now & user creation
                var diffDays = -Math.floor(time / 86400000); // days

                document.getElementById("creation-date").innerHTML = "Been a user for " + diffDays + " days. (Created on " + doc.data().creation + ")";
                document.title = doc.data().username + " - Bluekid";

                document.getElementById("profile").style.display = "";

                //<div class="badge" title="Given by FunFoxRR (Owner of Bluekid)">
                //   <img src="./assets/badges/OfficialCreator.png" width="32">
                //   <strong>Official Creator</strong>
                //</div>

                for (var i = 0; i < doc.data().badges.length; i++) {
                    const badge_name = doc.data().badges[i];

                    let badgeImageSrc = "./assets/Bluekid.png";
                    if (badge_name == "Official Creator") {
                        badgeImageSrc = "./assets/badges/OfficialCreator.png";
                    } else if (badge_name == "OG") {
                        badgeImageSrc = "./assets/badges/OGBadge.png";
                    } else if (badge_name == "Verified") {
                        badgeImageSrc = "./assets/badges/Verified.png";
                    } else if (badge_name == "Simonson Kid") {
                        badgeImageSrc = "./assets/badges/Nerd.png";
                    } else if (badge_name == "Boots") {
                        badgeImageSrc = "./assets/badges/Boots.png";
                    } else if (badge_name == "Content Creator") {
                        badgeImageSrc = "./assets/badges/ContentCreator.png";
                    }

                    const newDiv = document.createElement("div")
                    newDiv.className = "badge";
                    newDiv.title = "Given by FunFoxRR (Owner of Bluekid)";
                    newDiv.innerHTML = `<img src="${badgeImageSrc}" width="42"><strong>${badge_name}</strong>`;

                    document.getElementById("badges").appendChild(newDiv);
                }

                var bannedEmails = data.bannedEmailaddresses
                for (var i = 0; i < data.bannedEmailaddresses.length; i++) {
                    if (bannedEmails[i].email == firebase.auth().currentUser.email) {
                        document.getElementById("name").innerHTML = "You have been banned.";
                        document.getElementById("creation-date").innerHTML = "Reason: " + bannedEmails[i].reason;

                        document.getElementById("profile").remove();
                    }
                }
            })
        });

        document.getElementById("logout").onclick = logout;

        function creategame() {
            window.location.href = "./game.html?id="+Math.floor(Math.random()*100000)+"&name="+username;
        }
    </script>

    <!-- CONTEXT MENU -->
    <script>
        document.onclick = hideMenu;
        document.oncontextmenu = rightClick;

        let isMouseOverText = false;
        let text = document.getElementById("name");
        
        function hideMenu() {
            document.getElementById("contextMenu").style.display = "none"
        }

        text.addEventListener("mouseleave", function(event) {
            isMouseOverText = false;
        })

        text.addEventListener("mouseover", function(event) {
            isMouseOverText = true;
        })
    
        function rightClick(e) {
            if (isMouseOverText) {
                e.preventDefault();
    
                if (document.getElementById("contextMenu").style.display == "block")
                    hideMenu();
                else {
                    var menu = document.getElementById("contextMenu")
        
                    menu.style.display = 'block';
                    menu.style.left = e.pageX + "px";
                    menu.style.top = e.pageY + "px";
                }
            }
        }
    </script>
</body>
</html>