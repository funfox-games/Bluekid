import{onAuthStateChanged,auth,db,doc,getDoc,updateDoc}from"../util/firebase.js";let kitid_url=new URL(location.href).searchParams.get("id");function refreshQuestions(i){var t=document.getElementById("allQuestions").children;for(let e=0;e<t.length;e++)"ex"!=t[e].id&&t[e].remove();for(let e=0;e<i.length;e++){var n=i[e],d=(console.log(n),n.a1),r=n.a2,a=n.a3,l=n.a4,c=n.question,s=n.correctA,o=document.getElementById("ex").cloneNode(!0);o.id="",o.children[1].children[0].innerText=c,o.children[1].children[1].children[0].innerText=d,o.children[1].children[1].children[1].innerText=r,o.children[1].children[1].children[2].innerText=a,o.children[1].children[1].children[3].innerText=l,s.includes("1")&&(o.children[1].children[1].children[0].innerHTML='<i class="fa-solid fa-square-check"></i> '+d),s.includes("2")&&(o.children[1].children[1].children[1].innerHTML='<i class="fa-solid fa-square-check"></i> '+r),s.includes("3")&&(o.children[1].children[1].children[2].innerHTML='<i class="fa-solid fa-square-check"></i> '+a),s.includes("4")&&(o.children[1].children[1].children[3].innerHTML='<i class="fa-solid fa-square-check"></i> '+l),""==n.image||null==n.image?o.children[0].style.display="none":o.children[0].children[0].src=n.image,document.getElementById("allQuestions").append(o)}}onAuthStateChanged(auth,async e=>{if(e){var n=doc(db,"kits",kitid_url),n=await getDoc(n);if(n.exists()){n=(await getDoc(doc(db,"users",n.data().ownerUid,"kits",n.data().kitId))).data();if("private"==n.visibility)document.getElementById("notOwned").showModal(),document.getElementById("visibility").innerHTML=n.visibility;else{if("friends"==n.visibility){document.getElementById("preformingchecks").showModal();var d=await getDoc(doc(db,"kits",kitid_url)).then(async e=>(await getDoc(doc(db,"users",e.data().ownerUid))).data());if(document.getElementById("preformingchecks").close(),!d.friends.includes(e.uid)&&e.uid!=kitowner_url)return document.getElementById("visibility").innerHTML=n.visibility,void document.getElementById("notOwned").showModal()}document.getElementById("kitname").innerText=n.displayname,document.getElementById("desc").innerText=n.description,document.getElementById("coverimg").src=n.cover,null!=n.questions&&(refreshQuestions(n.questions),document.getElementById("questionamount").innerHTML=n.questions.length);let i=await getDoc(doc(db,"users",auth.currentUser.uid)),t=(null!=i.data().favoriteKits&&i.data().favoriteKits.includes(kitid_url)&&(document.getElementById("favoritekit").innerHTML='<i class="fa-solid fa-star"></i> Favorited kit'),!1);null!=i.data().favoriteKits&&i.data().favoriteKits.includes(kitid_url)&&(t=!0),document.getElementById("favoritekit").addEventListener("click",async()=>{var e;document.getElementById("favoritekit").innerHTML="Working...",document.getElementById("favoritekit").setAttribute("disabled",""),t=t?((e=i.data().favoriteKits||[])!=[]&&e.splice(e.indexOf(kitid_url),1),await updateDoc(doc(db,"users",auth.currentUser.uid),{favoriteKits:e}),document.getElementById("favoritekit").innerHTML='<i class="fa-regular fa-star"></i> Favorite kit',document.getElementById("favoritekit").removeAttribute("disabled"),!1):((e=i.data().favoriteKits||[]).push(kitid_url),await updateDoc(doc(db,"users",auth.currentUser.uid),{favoriteKits:e}),document.getElementById("favoritekit").innerHTML='<i class="fa-solid fa-star"></i> Favorited kit',document.getElementById("favoritekit").removeAttribute("disabled"),!0)})}}else document.getElementById("nonexistant").showModal()}else location.href="../../auth/login.html"});