import{auth,onAuthStateChanged,reauthenticateWithCredential,signOut,EmailAuthProvider,httpsCallable,functions,collection,doc,db,updateDoc,reauthenticateWithPopup,GoogleAuthProvider}from"../util/firebase.js";let urlParams=new URLSearchParams(window.location.search),confetti=new JSConfetti,bmac=(urlParams.has("bmacemail")||(alert("PromptError: BMAC Email and uid not provided. [bkp/pmpt_error]"),location.href="../../index.html"),httpsCallable(functions,"bmacVerification")),bmacSubDetails=await bmac(urlParams.get("bmacemail")).catch(e=>{alert("smth went wrong, check the console"),document.body.innerHTML="",console.log(e)});async function success(){await updateDoc(doc(db,"users",auth.currentUser.uid),{subscriptionDetails:{payerEmail:urlParams.get("bmacemail"),confirmationDate:new Date,subscriptionId:bmacSubDetails.data.subscriptionId}}).catch(e=>{alert("there was a problem saving subscription details... check the console..."),console.log("PROBLEM SAVING SUBSCRIPTION DETAILS: ",e)}),await httpsCallable(functions,"sendWelcomeToBKPEmail")(auth.currentUser.uid),confetti.addConfetti(),document.getElementById("working").close(),document.getElementById("congrats").showModal()}console.log(bmacSubDetails.data),0==bmacSubDetails.data.active&&(document.body.innerHTML="",alert("Subscription not active..."),location.href="../../index.html"),document.getElementById("google").addEventListener("click",async()=>{var e=new GoogleAuthProvider,e=(auth.useDeviceLanguage(),await reauthenticateWithPopup(auth.currentUser,e).catch(e=>{var t=e.code,a=e.message;e.customData.email,OAuthProvider.credentialFromError(e);return alert(t+" : "+a),!1}));0!=e&&(document.getElementById("working").showModal(),success())}),document.getElementById("reauth").addEventListener("click",async()=>{document.getElementById("reauth").setAttribute("disabled",!0),document.getElementById("reauth").innerHTML="Waiting...";var e=EmailAuthProvider.credential(auth.currentUser.email,document.getElementById("password").value);0!=await reauthenticateWithCredential(auth.currentUser,e).catch(e=>("auth/wrong-password"==e.code||"auth/missing-password"==e.code?alert("Wrong password."):(alert("Something went wrong, check the console."),console.log(e)),!1))&&success()});