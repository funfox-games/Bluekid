import{functions,httpsCallable,realtime,realtimeGet,ref}from"./../../util/firebase.js";let gameId=null,lastGameDataGet=null;function convertDictToArray(e){var a,t=[];for(a in e)e.hasOwnProperty(a)&&t.push([a,e[a]]);return t}async function getGameData(){return new Promise(async(e,a)=>{null==gameId&&a("Game ID not vaild.");a=await httpsCallable(functions,"hosting-viewHostData")(gameId);e(lastGameDataGet=a)})}async function setActiveGame(e){null!=gameId&&console.warn("GameID is already set! Proceeding with action..."),gameId=e}async function updateData(n){return new Promise(async(e,a)=>{var t=await httpsCallable(functions,"hosting-updateGameData")({gameId:gameId,toUpdate:n});0==t.success&&"permission/not_allowed"==t.error&&(console.warn('Insufficent permissions to update prop "'+t.failedProp+'"'),a(t.failedProp)),e()})}async function addTo(t,n){return new Promise(async e=>{var a=await httpsCallable(functions,"hosting-addTo")({gameId:gameId,field:t,toAdd:n});0==a.success&&"permission/not_allowed"==a.error&&(console.warn('Insufficent permissions to update prop "'+a.failedProp+'"'),rej(a.failedProp)),0==a.success&&(console.warn("Success false.",a),rej(null)),e()})}async function getKit(){return new Promise(async(e,a)=>{e((await realtimeGet(ref(realtime,"games/"+gameId))).val().kitData)})}async function wait(t){return new Promise(async(e,a)=>{setTimeout(()=>e(),1e3*t)})}function getRanks(e){return convertDictToArray(e).slice().sort(function(e,a){return a[1]-e[1]})}function getPlayerName(e){let a=null;for(var t in lastGameDataGet.players)if(t==e){a=lastGameDataGet.players[t].username;break}return a}export{getGameData,setActiveGame,updateData,addTo,getKit,wait,getRanks,getPlayerName};