import{onAuthStateChanged,auth,db,doc,getDoc,FirebaseHelper,ref,realtime,realtimeGet,HOSTING_VERSION}from"./util/firebase.js";let url=new URL(window.location.href),searchParams=url.searchParams;function showJoinError(e){showNotification(2,e)}onAuthStateChanged(auth,async o=>{document.getElementById("hostingversion").innerHTML=HOSTING_VERSION;var e=searchParams.get("error");if(e){switch(e){case"game_not_exist":showJoinError("Joinned game didn't exist.");break;case"game_deleted":showJoinError("Owner left.");break;case"kicked":showJoinError("Kicked.")}searchParams.delete("error")}let i=null,n,a=(o?(n=o.uid,console.log("Logged in: "+n),i=await FirebaseHelper.getUserData(n),showNotification(1,"Logged in as "+i.username),document.getElementById("notloggedin").style.display="none"):(console.log("Not logged in"),document.getElementById("notloggedin").innerHTML=`<i class="fa-solid fa-warning"></i> You aren't logged in.`),document.getElementById("join").innerHTML);document.getElementById("join").addEventListener("click",async()=>{function e(){document.getElementById("join").removeAttribute("disabled"),document.getElementById("join").innerHTML=a}document.getElementById("join").setAttribute("disabled",""),document.getElementById("join").innerHTML="Loading...";var n,t=document.getElementById("gid").value,t=parseInt(t);console.log(t),null==t||"NaN"==t.toString()?(showJoinError("Game ID but be a number."),e()):(n=ref(realtime,"games/"+t),n=await realtimeGet(n),console.log(n),n.exists()?o?(sessionStorage.setItem("joinningGame",JSON.stringify({gameId:t,username:i.username})),location.href="./game/client.html"):document.getElementById("setUsername").showModal():(showJoinError("Game doesn't exist."),e()))}),document.getElementById("setusernamejoin").addEventListener("click",()=>{sessionStorage.setItem("joinningGame",JSON.stringify({gameId:gid,username:document.getElementById("username").value})),location.href="./game/client.html"})});